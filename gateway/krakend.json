{
  "$schema": "https://www.krakend.io/schema/v3.json",
  "version": 3,
  "name": "TraWell - API Gateway",
  "timeout": "3000ms",
  "cache_ttl": "300s",
  "output_encoding": "no-op",
  "port": 9000,
  "endpoints": [
    {
      "endpoint": "/keycloak-protected",
      "output_encoding": "no-op",
      "extra_config": {
        "auth/validator": {
          "alg": "RS256",
          "jwk_url": "http://host.docker.internal:8403/auth/realms/TraWell/protocol/openid-connect/certs",
          "issuer": "http://localhost:8403/auth/realms/TraWell",
          "disable_jwk_security": true,
          "cache": true
        }
      },
      "backend": [
        {
          "url_pattern": "/__health",
          "encoding": "no-op",
          "host": [
            "host.docker.internal:9000"
          ]
        }
      ]
    },
    {
      "endpoint": "/authenticate",
      "method": "GET",
      "output_encoding": "no-op",
      "extra_config": {
        "auth/validator": {
          "alg": "RS256",
          "jwk_url": "http://host.docker.internal:8403/auth/realms/TraWell/protocol/openid-connect/certs",
          "issuer": "http://localhost:8403/auth/realms/TraWell",
          "disable_jwk_security": true
        }
      },
      "backend": [
        {
          "url_pattern": "/authenticate",
          "encoding": "no-op",
          "method": "GET",
          "host": [
            "host.docker.internal:8003"
          ]
        }
      ]
    },
    {
      "endpoint": "/rides/get_filtered/",
      "method": "GET",
      "output_encoding": "no-op",
      "input_query_strings": [
        "page",
        "city_from",
        "city_from_state",
        "city_from_county",
        "city_from_lat",
        "city_from_lng",
        "city_to",
        "city_to_state",
        "city_to_county",
        "city_to_lat",
        "city_to_lng",
        "ride_type",
        "driver_rate",
        "start_date",
        "seats",
        "price_from",
        "price_to",
        "ordering"
      ],
      "backend": [
        {
          "url_pattern": "/rides/get_filtered/",
          "encoding": "no-op",
          "method": "GET",
          "host": [
            "host.docker.internal:8001"
          ]
        }
      ]
    },
    {
      "endpoint": "/rides/",
      "method": "POST",
      "output_encoding": "no-op",
      "input_headers": [
        "*"
      ],
      "extra_config": {
        "auth/validator": {
          "alg": "RS256",
          "jwk_url": "http://host.docker.internal:8403/auth/realms/TraWell/protocol/openid-connect/certs",
          "issuer": "http://localhost:8403/auth/realms/TraWell",
          "disable_jwk_security": true
        }
      },
      "backend": [
        {
          "url_pattern": "/rides/",
          "extra_config": {
            "backend/http": {
              "return_error_details": "ride_serivce"
            }
          },
          "encoding": "no-op",
          "method": "POST",
          "host": [
            "host.docker.internal:8001"
          ]
        }
      ]
    },
    {
      "endpoint": "/rides/{ride_id}",
      "method": "GET",
      "output_encoding": "no-op",
      "extra_config": {
        "auth/validator": {
          "alg": "RS256",
          "jwk_url": "http://host.docker.internal:8403/auth/realms/TraWell/protocol/openid-connect/certs",
          "issuer": "http://localhost:8403/auth/realms/TraWell",
          "disable_jwk_security": true
        }
      },
      "backend": [
        {
          "url_pattern": "/rides/{ride_id}",
          "encoding": "no-op",
          "method": "GET",
          "host": [
            "host.docker.internal:8001"
          ]
        }
      ],
      "input_query_strings": [
        "{ride_id}"
      ]
    },
    {
      "endpoint": "/rides/{ride_id}/",
      "method": "DELETE",
      "output_encoding": "no-op",
      "extra_config": {
        "auth/validator": {
          "alg": "RS256",
          "jwk_url": "http://host.docker.internal:8403/auth/realms/TraWell/protocol/openid-connect/certs",
          "issuer": "http://localhost:8403/auth/realms/TraWell",
          "disable_jwk_security": true
        }
      },
      "backend": [
        {
          "url_pattern": "/rides/{ride_id}/",
          "encoding": "no-op",
          "method": "DELETE",
          "host": [
            "host.docker.internal:8001"
          ]
        }
      ],
      "input_query_strings": [
        "{ride_id}"
      ]
    },
    {
      "endpoint": "/rides/user_rides/{user_id}",
      "method": "GET",
      "output_encoding": "no-op",
      "extra_config": {
        "auth/validator": {
          "alg": "RS256",
          "jwk_url": "http://host.docker.internal:8403/auth/realms/TraWell/protocol/openid-connect/certs",
          "issuer": "http://localhost:8403/auth/realms/TraWell",
          "disable_jwk_security": true
        }
      },
      "backend": [
        {
          "url_pattern": "/user_rides/{user_id}",
          "encoding": "no-op",
          "method": "GET",
          "host": [
            "host.docker.internal:8001"
          ]
        }
      ],
      "input_query_strings": [
        "{user_id}",
        "page",
        "city_from",
        "city_from_state",
        "city_from_county",
        "city_from_lat",
        "city_from_lng",
        "city_to",
        "city_to_state",
        "city_to_county",
        "city_to_lat",
        "city_to_lng",
        "start_date",
        "ordering"
      ]
    },
    {
      "endpoint": "/rides/{ride_id}/send_request",
      "method": "POST",
      "output_encoding": "no-op",
      "input_headers": [
        "*"
      ],
      "extra_config": {
        "auth/validator": {
          "alg": "RS256",
          "jwk_url": "http://host.docker.internal:8403/auth/realms/TraWell/protocol/openid-connect/certs",
          "issuer": "http://localhost:8403/auth/realms/TraWell",
          "disable_jwk_security": true
        }
      },
      "backend": [
        {
          "url_pattern": "/rides/{ride_id}/request",
          "encoding": "no-op",
          "method": "POST",
          "host": [
            "host.docker.internal:8001"
          ]
        }
      ],
      "input_query_strings": [
        "{ride_id}"
      ]
    },
    {
      "endpoint": "/rides/request/{request_id}",
      "method": "DELETE",
      "output_encoding": "no-op",
      "extra_config": {
        "auth/validator": {
          "alg": "RS256",
          "jwk_url": "http://host.docker.internal:8403/auth/realms/TraWell/protocol/openid-connect/certs",
          "issuer": "http://localhost:8403/auth/realms/TraWell",
          "disable_jwk_security": true
        }
      },
      "backend": [
        {
          "url_pattern": "/rides/request/{request_id}",
          "encoding": "no-op",
          "method": "DELETE",
          "host": [
            "host.docker.internal:8001"
          ]
        }
      ],
      "input_query_strings": [
        "{request_id}"
      ]
    },
    {
      "endpoint": "/rides/request/{request_id}",
      "method": "POST",
      "output_encoding": "no-op",
      "input_headers": [
        "*"
      ],
      "extra_config": {
        "auth/validator": {
          "alg": "RS256",
          "jwk_url": "http://host.docker.internal:8403/auth/realms/TraWell/protocol/openid-connect/certs",
          "issuer": "http://localhost:8403/auth/realms/TraWell",
          "disable_jwk_security": true
        }
      },
      "backend": [
        {
          "url_pattern": "/rides/request/{request_id}",
          "encoding": "no-op",
          "method": "POST",
          "host": [
            "host.docker.internal:8001"
          ]
        }
      ],
      "input_query_strings": [
        "{request_id}"
      ]
    },
    {
      "endpoint": "/rides/{ride_id}/check_edition_permissions/",
      "method": "GET",
      "output_encoding": "no-op",
      "input_headers": [
        "*"
      ],
      "extra_config": {
        "auth/validator": {
          "alg": "RS256",
          "jwk_url": "http://host.docker.internal:8403/auth/realms/TraWell/protocol/openid-connect/certs",
          "issuer": "http://localhost:8403/auth/realms/TraWell",
          "disable_jwk_security": true
        }
      },
      "backend": [
        {
          "url_pattern": "/rides/{ride_id}/check_edition_permissions/",
          "encoding": "no-op",
          "method": "GET",
          "host": [
            "host.docker.internal:8001"
          ]
        }
      ],
      "input_query_strings": [
        "{ride_id}"
      ]
    },
    {
      "endpoint": "/users/{user_id}",
      "method": "GET",
      "output_encoding": "no-op",
      "extra_config": {
        "auth/validator": {
          "alg": "RS256",
          "jwk_url": "http://host.docker.internal:8403/auth/realms/TraWell/protocol/openid-connect/certs",
          "issuer": "http://localhost:8403/auth/realms/TraWell",
          "disable_jwk_security": true
        }
      },
      "backend": [
        {
          "url_pattern": "/users/{user_id}",
          "encoding": "no-op",
          "method": "GET",
          "host": [
            "host.docker.internal:8003"
          ]
        }
      ],
      "input_query_strings": [
        "{user_id}"
      ]
    },
    {
      "endpoint": "/vehicles/{user_id}",
      "method": "GET",
      "output_encoding": "no-op",
      "extra_config": {
        "auth/validator": {
          "alg": "RS256",
          "jwk_url": "http://host.docker.internal:8403/auth/realms/TraWell/protocol/openid-connect/certs",
          "issuer": "http://localhost:8403/auth/realms/TraWell",
          "disable_jwk_security": true
        }
      },
      "backend": [
        {
          "url_pattern": "/vehicles/{user_id}",
          "encoding": "no-op",
          "method": "GET",
          "host": [
            "host.docker.internal:8003"
          ]
        }
      ],
      "input_query_strings": [
        "{user_id}"
      ]
    },
    {
      "endpoint": "/vehicles/{user_id}",
      "method": "POST",
      "output_encoding": "no-op",
      "input_headers": [
        "*"
      ],
      "extra_config": {
        "auth/validator": {
          "alg": "RS256",
          "jwk_url": "http://host.docker.internal:8403/auth/realms/TraWell/protocol/openid-connect/certs",
          "issuer": "http://localhost:8403/auth/realms/TraWell",
          "disable_jwk_security": true
        }
      },
      "backend": [
        {
          "url_pattern": "/vehicles/{user_id}",
          "encoding": "no-op",
          "method": "POST",
          "host": [
            "host.docker.internal:8003"
          ]
        }
      ],
      "input_query_strings": [
        "{user_id}"
      ]
    },
    {
      "endpoint": "/vehicles/{car_id}",
      "method": "DELETE",
      "output_encoding": "no-op",
      "extra_config": {
        "auth/validator": {
          "alg": "RS256",
          "jwk_url": "http://host.docker.internal:8403/auth/realms/TraWell/protocol/openid-connect/certs",
          "issuer": "http://localhost:8403/auth/realms/TraWell",
          "disable_jwk_security": true
        }
      },
      "backend": [
        {
          "url_pattern": "/vehicles/{car_id}",
          "encoding": "no-op",
          "method": "DELETE",
          "host": [
            "host.docker.internal:8003"
          ]
        }
      ],
      "input_query_strings": [
        "{car_id}"
      ]
    },
    {
      "endpoint": "/notifications/new_request/{ride_id}",
      "method": "POST",
      "output_encoding": "no-op",
      "input_headers": [
        "*"
      ],
      "extra_config": {
        "auth/validator": {
          "alg": "RS256",
          "jwk_url": "http://host.docker.internal:8403/auth/realms/TraWell/protocol/openid-connect/certs",
          "issuer": "http://localhost:8403/auth/realms/TraWell",
          "disable_jwk_security": true
        }
      },
      "backend": [
        {
          "url_pattern": "/api/notifications/new_request/{ride_id}",
          "encoding": "no-op",
          "method": "POST",
          "host": [
            "host.docker.internal:8005"
          ]
        }
      ],
      "input_query_strings": [
        "{ride_id}"
      ]
    },
    {
      "endpoint": "/notifications/request_confirm/{ride_id}",
      "method": "POST",
      "output_encoding": "no-op",
      "input_headers": [
        "*"
      ],
      "extra_config": {
        "auth/validator": {
          "alg": "RS256",
          "jwk_url": "http://host.docker.internal:8403/auth/realms/TraWell/protocol/openid-connect/certs",
          "issuer": "http://localhost:8403/auth/realms/TraWell",
          "disable_jwk_security": true
        }
      },
      "backend": [
        {
          "url_pattern": "/api/notifications/request_confirm/{ride_id}",
          "encoding": "no-op",
          "method": "POST",
          "host": [
            "host.docker.internal:8005"
          ]
        }
      ],
      "input_query_strings": [
        "{ride_id}"
      ]
    },
    {
      "endpoint": "/notifications/edit_ride/{ride_id}",
      "method": "POST",
      "output_encoding": "no-op",
      "input_headers": [
        "*"
      ],
      "extra_config": {
        "auth/validator": {
          "alg": "RS256",
          "jwk_url": "http://host.docker.internal:8403/auth/realms/TraWell/protocol/openid-connect/certs",
          "issuer": "http://localhost:8403/auth/realms/TraWell",
          "disable_jwk_security": true
        }
      },
      "backend": [
        {
          "url_pattern": "/api/notifications/edit_ride/{ride_id}",
          "encoding": "no-op",
          "method": "POST",
          "host": [
            "host.docker.internal:8005"
          ]
        }
      ],
      "input_query_strings": [
        "{ride_id}"
      ]
    },
    {
      "endpoint": "/notifications/cancelled_info/{ride_id}",
      "method": "POST",
      "output_encoding": "no-op",
      "input_headers": [
        "*"
      ],
      "extra_config": {
        "auth/validator": {
          "alg": "RS256",
          "jwk_url": "http://host.docker.internal:8403/auth/realms/TraWell/protocol/openid-connect/certs",
          "issuer": "http://localhost:8403/auth/realms/TraWell",
          "disable_jwk_security": true
        }
      },
      "backend": [
        {
          "url_pattern": "/api/notifications/cancelled_info/{ride_id}",
          "encoding": "no-op",
          "method": "POST",
          "host": [
            "host.docker.internal:8005"
          ]
        }
      ],
      "input_query_strings": [
        "{ride_id}"
      ]
    },
    {
      "endpoint": "/notifications/resignation_info/{ride_id}",
      "method": "POST",
      "output_encoding": "no-op",
      "input_headers": [
        "*"
      ],
      "extra_config": {
        "auth/validator": {
          "alg": "RS256",
          "jwk_url": "http://host.docker.internal:8403/auth/realms/TraWell/protocol/openid-connect/certs",
          "issuer": "http://localhost:8403/auth/realms/TraWell",
          "disable_jwk_security": true
        }
      },
      "backend": [
        {
          "url_pattern": "/api/notifications/resignation_info/{ride_id}",
          "encoding": "no-op",
          "method": "POST",
          "host": [
            "host.docker.internal:8005"
          ]
        }
      ],
      "input_query_strings": [
        "{ride_id}"
      ]
    },
    {
      "endpoint": "/reviews/{user_id}",
      "method": "GET",
      "output_encoding": "no-op",
      "extra_config": {
        "auth/validator": {
          "alg": "RS256",
          "jwk_url": "http://host.docker.internal:8403/auth/realms/TraWell/protocol/openid-connect/certs",
          "issuer": "http://localhost:8403/auth/realms/TraWell",
          "disable_jwk_security": true
        }
      },
      "backend": [
        {
          "url_pattern": "/reviews/{user_id}",
          "encoding": "no-op",
          "method": "GET",
          "host": [
            "host.docker.internal:8004"
          ]
        }
      ],
      "input_query_strings": [
        "{user_id}"
      ]
    },
    {
      "endpoint": "/reviews/{user_id}",
      "method": "POST",
      "output_encoding": "no-op",
      "input_headers": [
        "*"
      ],
      "extra_config": {
        "auth/validator": {
          "alg": "RS256",
          "jwk_url": "http://host.docker.internal:8403/auth/realms/TraWell/protocol/openid-connect/certs",
          "issuer": "http://localhost:8403/auth/realms/TraWell",
          "disable_jwk_security": true
        }
      },
      "backend": [
        {
          "url_pattern": "/reviews/{user_id}",
          "encoding": "no-op",
          "method": "POST",
          "host": [
            "host.docker.internal:8004"
          ]
        }
      ],
      "input_query_strings": [
        "{user_id}"
      ]
    },
    {
      "endpoint": "/reviews/{review_id}",
      "method": "DELETE",
      "output_encoding": "no-op",
      "extra_config": {
        "auth/validator": {
          "alg": "RS256",
          "jwk_url": "http://host.docker.internal:8403/auth/realms/TraWell/protocol/openid-connect/certs",
          "issuer": "http://localhost:8403/auth/realms/TraWell",
          "disable_jwk_security": true
        }
      },
      "backend": [
        {
          "url_pattern": "/reviews/{review_id}",
          "encoding": "no-op",
          "method": "DELETE",
          "host": [
            "host.docker.internal:8004"
          ]
        }
      ],
      "input_query_strings": [
        "{review_id}"
      ]
    }
  ]
}
